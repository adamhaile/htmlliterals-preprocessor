!function(e){var t={},n={};e(function(e,n,i){if(t.hasOwnProperty(e))throw new Error("define: cannot redefine module "+e);t[e]=i.apply(null,n.map(function(n){if(!t.hasOwnProperty(n))throw new Error("define: module "+n+" required by "+e+" has not been defined.");return t[n]}))}),"object"==typeof exports?n=exports:"function"==typeof define?define([],function(){return n}):n=this.htmlliterals=this.htmlliterals||n,n.preprocess=t.preprocess}(function(e){"use strict";e("tokenize",[],function(){var e={tokens:/<\/?(?=\w)|\/?>|<!--|-->|@|=|\)|\(|\[|\]|\{|\}|"|'|\/\/|\n|\/\*|\*\/|(?:[^<>@=\/@=()[\]{}"'\n*-]|(?!-->)-|\/(?![>/*])|\*(?!\/)|(?!<\/?\w|<!--)<\/?)+/g};return function(t){var n=t.match(e.tokens);return n}}),e("AST",[],function(){return{CodeTopLevel:function(e){this.segments=e},CodeText:function(e){this.text=e},EmbeddedCode:function(e){this.segments=e},HtmlLiteral:function(e,t){this.col=e,this.nodes=t},HtmlElement:function(e,t,n,i,r){this.beginTag=e,this.properties=t,this.directives=n,this.content=i,this.endTag=r},HtmlText:function(e){this.text=e},HtmlComment:function(e){this.text=e},HtmlInsert:function(e,t){this.col=e,this.code=t},Property:function(e,t,n){this.name=e,this.code=t,this.callback=n},Directive:function(e,t){this.name=e,this.code=t},AttrStyleDirective:function(e,t,n,i){this.name=e,this.params=t,this.code=n,this.callback=i}}}),e("parse",["AST"],function(e){var t={propertyLeftSide:/\s(\S+)\s*=>?\s*$/,embeddedCodePrefix:/^[+\-!~]*[a-zA-Z_$][a-zA-Z_$0-9]*/,embeddedCodeInterim:/^(?:\.[a-zA-Z_$][a-zA-Z_$0-9]+)+/,embeddedCodeSuffix:/^\+\+|--/,directiveName:/^[a-zA-Z_$][a-zA-Z_$0-9]*(:[^\s:=]*)*/,stringEscapedEnd:/[^\\](\\\\)*\\$/,ws:/^\s*$/,leadingWs:/^\s+/,tagTrailingWs:/\s+(?=\/?>$)/,emptyLines:/\n\s+(?=\n)/g},n={"(":")","[":"]","{":"}"};return function(i){function r(){for(var t=[],n="";!S;)C("<")||C("<!--")?(n&&t.push(new e.CodeText(n)),n="",t.push(o())):C('"')||C("'")?n+=p():C("//")?n+=g():C("/*")?n+=v():(n+=k,y());return n&&t.push(new e.CodeText(n)),new e.CodeTopLevel(t)}function o(){H("<")&&H("<!--")&&x("not at start of html expression");for(var t,n,i=I,r=[];!S;)if(C("<"))r.push(s());else if(C("<!--"))r.push(l());else if(C("@"))r.push(f());else{if(t=D(),n=c(),S||!(C("<")||C("<!--")||C("@"))){L(t);break}r.push(n)}return new e.HtmlLiteral(i,r)}function s(){H("<")&&x("not at start of html element");var n="",i=[],r=[],o=[],c="",d=!0;for(n+=k,y();!S&&H(">")&&H("/>");)C("@")?r.push(m()):C("=")?n=a(n,i):(n+=k,y());if(S&&x("unterminated start node"),d=C(">"),n+=k,y(),n=n.replace(t.tagTrailingWs,"").replace(t.emptyLines,""),d){for(;!S&&H("</");)o.push(C("<")?s():C("@")?f():C("<!--")?l():u());for(S&&x("element missing close tag");!S&&H(">");)c+=k,y();S&&x("eof while looking for element close tag"),c+=k,y()}return new e.HtmlElement(n,i,r,o,c)}function u(){for(var t="";!S&&H("<")&&H("<!--")&&H("@")&&H("</");)t+=k,y();return new e.HtmlText(t)}function c(){for(var t="";!S&&b();)t+=k,y();return new e.HtmlText(t)}function l(){H("<!--")&&x("not in HTML comment");for(var t="";!S&&H("-->");)t+=k,y();return S&&x("unterminated html comment"),t+=k,y(),new e.HtmlComment(t)}function f(){H("@")&&x("not at start of code insert");var t=I;return y(),new e.HtmlInsert(t,d())}function a(n,i){H("=")&&x("not at equals sign of a property assignment");var r,o,s=!1;return n+=k,y(),C(">")&&(s=!0,n+=k,y()),b()&&(n+=k,y()),r=t.propertyLeftSide.exec(n),r&&(s||H('"')&&H("'"))&&(n=n.substring(0,n.length-r[0].length),o=r[1],E(t.leadingWs),i.push(new e.Property(o,d(),s))),n}function m(){H("@")&&x("not at start of directive"),y();var n,i,r=E(t.directiveName),o=!1;return r||x("directive must have name"),C("(")?(i=[],n=h(i,""),n&&i.push(n),new e.Directive(r,new e.EmbeddedCode(i))):(b()&&y(),H("=")&&x("unrecognized directive - must have form like @foo:bar = ... or @foo( ... )"),y(),C(">")&&(o=!0,y()),E(t.leadingWs),r=r.split(":"),new e.AttrStyleDirective(r[0],r.slice(1),d(),o))}function d(){var n,i=[],r="";for((n=E(t.embeddedCodePrefix))&&(r+=n,(n=E(t.embeddedCodeInterim))&&(r+=n));_();)r=h(i,r),(n=E(t.embeddedCodeInterim))&&(r+=n);return(n=E(t.embeddedCodeSuffix))&&(r+=n),r&&i.push(new e.CodeText(r)),0===i.length&&x("not in embedded code"),new e.EmbeddedCode(i)}function h(t,n){var i=_();for(void 0===i&&x("not in parentheses"),n+=k,y();!S&&H(i);)C("'")||C('"')?n+=p():C("//")?n+=g():C("/*")?n+=v():C("<")||C("<!--")?(n&&t.push(new e.CodeText(n)),n="",t.push(o())):C("(")?n=h(t,n):(n+=k,y());return S&&x("unterminated parentheses"),n+=k,y(),n}function p(){H("'")&&H('"')&&x("not in quoted string");var e,n;for(e=n=k,y();!S&&(H(e)||t.stringEscapedEnd.test(n));)n+=k,y();return S&&x("unterminated string"),n+=k,y(),n}function g(){H("//")&&x("not in code comment");for(var e="";!S&&H("\n");)e+=k,y();return S||(e+=k,y()),e}function v(){H("/*")&&x("not in code comment");for(var e="";!S&&H("*/");)e+=k,y();return S&&x("unterminated multi-line comment"),e+=k,y(),e}function y(){"\n"===k?($++,I=0):k&&(I+=k.length),++A>=i.length?(S=!0,k=null):k=i[A]}function x(e){throw new Error(e)}function C(e){return k===e}function H(e){return k!==e}function w(e){return e.test(k)}function T(e){return e.exec(k)}function b(){return!!w(t.ws)}function _(){return n[k]}function E(e){var t=T(e);return t&&(t=t[0])?(I+=t.length,k=k.substring(t.length),""===k&&y(),t):null}function D(){return{TOK:k,i:A,EOF:S,LINE:$,COL:I}}function L(e){k=e.TOK,A=e.i,S=e.EOF,$=e.LINE,I=e.COL}var A=0,S=0===i.length,k=!S&&i[A],$=0,I=0;return r()}}),e("genCode",["AST"],function(e){function t(e,t){var n,i,r=[],o=[],u=[],c=t+"    ",l=c+"     ",f="";for(i=0;i<e.length;i++)n=e[i].genDirectives(l),n&&(r.push(i),u.push(s(e[i])),o.push(n));if(r.length){for(f+=".child(["+r.join(", ")+"], function (__) {"+c,i=0;i<o.length;i++)i&&(f+=c),f+="// "+u[i]+c,f+="__["+i+"]"+o[i]+";";f+=t+"})"}return f}function n(e,t,n){var i,r="";for(i=0;i<e.length;i++)i&&n&&(r+=n),r+=e[i][t](r);return r}function i(e){return"'"+e.replace(c.backslashes,"\\\\").replace(c.singleQuotes,"\\'").replace(c.newlines,"\\\n")+"'"}function r(e,t){var n=c.eventProperty.test(e)?e.substring(2):"__";return"function ("+n+") { "+t+" }"}function o(e){var t=c.lastline.exec(e);return t=t?t[0]:"",t.replace(c.nonws," ")}function s(e){return u(e.beginTag||e.text||e.genHtml())}function u(e){var t=c.firstline.exec(e);return t?t[0]:""}var c={eventProperty:/^on/,backslashes:/\\/g,newlines:/\n/g,singleQuotes:/'/g,firstline:/^[^\n]*/,lastline:/[^\n]*$/,nonws:/\S/g};e.CodeTopLevel.prototype.genCode=e.EmbeddedCode.prototype.genCode=function(){return n(this.segments,"genCode")},e.CodeText.prototype.genCode=function(){return this.text};var l=0;e.HtmlLiteral.prototype.genCode=function(e){var r=n(this.nodes,"genHtml"),s="\n"+o(e),u=this.nodes.length>1?t(this.nodes,s):this.nodes[0].genDirectives(s),c="new Html("+l++ +","+s+i(r)+")";return u&&(c+=s+u+s),c="("+c+".node)"},e.HtmlElement.prototype.genHtml=function(){return this.beginTag+n(this.content,"genHtml")+(this.endTag||"")},e.HtmlComment.prototype.genHtml=e.HtmlText.prototype.genHtml=function(){return this.text},e.HtmlInsert.prototype.genHtml=function(){return"<!-- insert -->"},e.HtmlElement.prototype.genDirectives=function(e){var i=t(this.content,e),r=n(this.properties,"genDirective",e),o=n(this.directives,"genDirective",e);return r+(r&&(o||i)?e:"")+o+(o&&i?e:"")+i},e.HtmlComment.prototype.genDirectives=e.HtmlText.prototype.genDirectives=function(){return null},e.HtmlInsert.prototype.genDirectives=function(){return new e.AttrStyleDirective("insert",[],this.code).genDirective()},e.Property.prototype.genDirective=function(){var e=this.code.genCode();return this.callback&&(e=r(this.name,e)),".property(function (__) { __."+this.name+" = "+e+"; })"},e.Directive.prototype.genDirective=function(){return"."+this.name+"(function (__) { __"+this.code.genCode()+"; })"},e.AttrStyleDirective.prototype.genDirective=function(){for(var e="."+this.name+"(function (__) { __(",t=0;t<this.params.length;t++)e+=i(this.params[t])+", ";return e+=this.callback?r(this.name,this.code.genCode()):this.code.genCode(),e+="); })"}}),e("shims",["AST"],function(e){function t(){var e=document.createElement("ul");return e.innerHTML="    <li></li>",2===e.childNodes.length}function n(){s(e.HtmlText,function(t){!ws.test(this.text)||t.parent instanceof e.HtmlAttr||(this.text="&#xfeff;"+this.text)})}function i(){var e=document.createElement("ul");return e.innerHTML="<!-- --><li></li>",2===e.childNodes.length}function r(){s(e.HtmlComment,function(t){0===t.index&&u(new e.HtmlText("&#xfeff;"),t)})}function o(e,t){for(var n={index:0,parent:e,sibings:t};n.index<t.length;n.index++)t[n.index].shim(n)}function s(e,t){c=!0;var n=e.prototype.shim;e.prototype.shim=function(e){t.call(this,e),n.call(this,e)}}function u(e,t){t.siblings.splice(t.index,0,e),e.shim(t),t.index++}var c=!1;return e.CodeTopLevel.prototype.shim=function(e){o(this,this.segments,e)},e.HtmlLiteral.prototype.shim=function(e){o(this,this.nodes,e)},e.HtmlElement.prototype.shim=function(e){o(this,this.content,e)},e.HtmlInsert.prototype.shim=function(e){o(this,this.segments,e)},e.CodeText.prototype.shim=e.HtmlText.prototype.shim=e.HtmlComment.prototype.shim=function(){},t()||n(),i()||r(),c}),e("preprocess",["tokenize","parse","shims"],function(e,t,n){return function(i){var r=e(i),o=t(r);n&&o.shim();var s=o.genCode();return s}})});