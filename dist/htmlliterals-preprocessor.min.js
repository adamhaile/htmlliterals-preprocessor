!function(e){var t={},n={};e(function(e,n,r){if(t.hasOwnProperty(e))throw new Error("define: cannot redefine module "+e);t[e]=r.apply(null,n.map(function(n){if(!t.hasOwnProperty(n))throw new Error("define: module "+n+" required by "+e+" has not been defined.");return t[n]}))}),"object"==typeof exports?n=exports:"function"==typeof define?define([],function(){return n}):n=this.htmlliterals=this.htmlliterals||n,n.preprocess=t.preprocess}(function(e){"use strict";e("sourcemap",[],function(){function e(e){return"\x00"+e.line+","+e.col+"\x00"}function t(){return"\x00\x00"}function n(e){var t="",n=0,r=0,i=0,o=!1,c=0,a=!1,l=e.replace(u.locs,function(e,u,l,f,m,p,d){if(u)return t+=";",o?(t+="AA"+s(1)+s(0-i),r++,i=0,a=!0):a=!1,c=d+u.length,n=0,u;if(l){var h=d-c;return f=parseInt(f),m=parseInt(m),t+=(a?",":"")+s(h-n)+"A"+s(f-r)+s(m-i),o=!0,a=!0,n=h,r=f,i=m,""}return p?(o=!1,""):void 0});return{src:l,mappings:t}}function r(e,t){var r=n(e),o=i(r.mappings,t);return{src:r.src,map:o}}function i(e,t){return{version:3,file:"out.js",sources:["in.js"],sourcesContent:[t],names:[],mappings:e}}function o(e,t){var n=r(e,t),i=n.src+"\n//# sourceMappingURL=data:"+escape(JSON.stringify(n.map));return i}function s(e){var t,n="";for(e=0>e?(-e<<1)+1:e<<1,e=e.toString(32),t=e.length-1;t>0;t--)n+=a[parseInt(e[t],32)];return n+=c[parseInt(e[0],32)]}var u={locs:/(\n)|(\u0000(\d+),(\d+)\u0000)|(\u0000\u0000)/g},c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdef",a="ghijklmnopqrstuvwxyz0123456789+/";return{segmentStart:e,segmentEnd:t,extractMap:r,appendMap:o}}),e("tokenize",[],function(){var e={tokens:/<\/?(?=\w)|\/?>|<!--|-->|@|=|\)|\(|\[|\]|\{|\}|"|'|\/\/|\n|\/\*|\*\/|(?:[^<>@=\/@=()[\]{}"'\n*-]|(?!-->)-|\/(?![>/*])|\*(?!\/)|(?!<\/?\w|<!--)<\/?)+/g};return function(t){var n=t.match(e.tokens);return n}}),e("AST",[],function(){return{CodeTopLevel:function(e){this.segments=e},CodeText:function(e,t){this.text=e,this.loc=t},EmbeddedCode:function(e){this.segments=e},HtmlLiteral:function(e){this.nodes=e},HtmlElement:function(e,t,n,r,i){this.beginTag=e,this.properties=t,this.directives=n,this.content=r,this.endTag=i},HtmlText:function(e){this.text=e},HtmlComment:function(e){this.text=e},HtmlInsert:function(e){this.code=e},Property:function(e,t,n){this.name=e,this.code=t,this.callback=n},Directive:function(e,t){this.name=e,this.code=t},AttrStyleDirective:function(e,t,n,r){this.name=e,this.params=t,this.code=n,this.callback=r}}}),e("parse",["AST"],function(e){var t={propertyLeftSide:/\s(\S+)\s*=>?\s*$/,embeddedCodePrefix:/^[+\-!~]*[a-zA-Z_$][a-zA-Z_$0-9]*/,embeddedCodeInterim:/^(?:\.[a-zA-Z_$][a-zA-Z_$0-9]*)+/,embeddedCodeSuffix:/^\+\+|--/,directiveName:/^[a-zA-Z_$][a-zA-Z_$0-9]*(:[^\s:=]*)*/,stringEscapedEnd:/[^\\](\\\\)*\\$/,ws:/^\s*$/,leadingWs:/^\s+/,tagTrailingWs:/\s+(?=\/?>$)/,emptyLines:/\n\s+(?=\n)/g},n={"(":")","[":"]","{":"}"};return function(r){function i(){for(var t=[],n="",r=L();!I;)C("<")||C("<!--")||C("@")?(n&&t.push(new e.CodeText(n,r)),n="",t.push(o()),r=L()):C('"')||C("'")?n+=h():C("//")?n+=g():C("/*")?n+=v():(n+=k,x());return n&&t.push(new e.CodeText(n,r)),new e.CodeTopLevel(t)}function o(){H("<")&&H("<!--")&&H("@")&&y("not at start of html expression");for(var t,n,r=[];!I;)if(C("<"))r.push(s());else if(C("<!--"))r.push(a());else if(C("@"))r.push(l());else{if(t=D(),n=c(),I||!(C("<")||C("<!--")||C("@"))){A(t);break}r.push(n)}return new e.HtmlLiteral(r)}function s(){H("<")&&y("not at start of html element");var n=L(),r="",i=[],o=[],c=[],p="",d=!0;for(r+=k,x();!I&&H(">")&&H("/>");)C("@")?o.push(m()):C("=")?r=f(r,i):(r+=k,x());if(I&&y("unterminated start node",n),d=C(">"),r+=k,x(),r=r.replace(t.tagTrailingWs,"").replace(t.emptyLines,""),d){for(;!I&&H("</");)c.push(C("<")?s():C("@")?l():C("<!--")?a():u());for(I&&y("element missing close tag");!I&&H(">");)p+=k,x();I&&y("eof while looking for element close tag"),p+=k,x()}return new e.HtmlElement(r,i,o,c,p)}function u(){for(var t="";!I&&H("<")&&H("<!--")&&H("@")&&H("</");)t+=k,x();return new e.HtmlText(t)}function c(){for(var t="";!I&&b();)t+=k,x();return new e.HtmlText(t)}function a(){H("<!--")&&y("not in HTML comment");for(var t="";!I&&H("-->");)t+=k,x();return I&&y("unterminated html comment"),t+=k,x(),new e.HtmlComment(t)}function l(){return H("@")&&y("not at start of code insert"),x(),new e.HtmlInsert(p())}function f(n,r){H("=")&&y("not at equals sign of a property assignment");var i,o,s=!1;return n+=k,x(),C(">")&&(s=!0,n+=k,x()),b()&&(n+=k,x()),i=t.propertyLeftSide.exec(n),i&&(s||H('"')&&H("'"))&&(n=n.substring(0,n.length-i[0].length),o=i[1],_(t.leadingWs),r.push(new e.Property(o,p(),s))),n}function m(){H("@")&&y("not at start of directive"),x();var n,r,i,o=_(t.directiveName),s=!1;return o||y("directive must have name"),C("(")?(r=[],i=L(),n=d(r,"",i),n&&r.push(new e.CodeText(n,i)),new e.Directive(o,new e.EmbeddedCode(r))):(b()&&x(),H("=")&&y("unrecognized directive - must have form like @foo:bar = ... or @foo( ... )"),x(),C(">")&&(s=!0,x()),_(t.leadingWs),o=o.split(":"),new e.AttrStyleDirective(o[0],o.slice(1),p(),s))}function p(){var n,r=L(),i=[],o="",s=L();for((n=_(t.embeddedCodePrefix))&&(o+=n,(n=_(t.embeddedCodeInterim))&&(o+=n));E();)o=d(i,o,s),(n=_(t.embeddedCodeInterim))&&(o+=n);return(n=_(t.embeddedCodeSuffix))&&(o+=n),o&&i.push(new e.CodeText(o,s)),0===i.length&&y("not in embedded code",r),new e.EmbeddedCode(i)}function d(t,n,r){var i=E();for(void 0===i&&y("not in parentheses"),n+=k,x();!I&&H(i);)C("'")||C('"')?n+=h():C("//")?n+=g():C("/*")?n+=v():C("<")||C("<!--")?(n&&t.push(new e.CodeText(n,{line:r.line,col:r.col})),n="",t.push(o()),r.line=$,r.col=z):C("(")?n=d(t,n,r):(n+=k,x());return I&&y("unterminated parentheses"),n+=k,x(),n}function h(){H("'")&&H('"')&&y("not in quoted string");var e,n;for(e=n=k,x();!I&&(H(e)||t.stringEscapedEnd.test(n));)n+=k,x();return I&&y("unterminated string"),n+=k,x(),n}function g(){H("//")&&y("not in code comment");for(var e="";!I&&H("\n");)e+=k,x();return I||(e+=k,x()),e}function v(){H("/*")&&y("not in code comment");for(var e="";!I&&H("*/");)e+=k,x();return I&&y("unterminated multi-line comment"),e+=k,x(),e}function x(){"\n"===k?($++,z=0,O++):k&&(z+=k.length,O+=k.length),++S>=r.length?(I=!0,k=null):k=r[S]}function y(e,t){var n=t?" at line "+t.line+" col "+t.col+": ``"+r.join("").substr(t.pos,30).replace("\n","")+"''":"";throw new Error(e+n)}function C(e){return k===e}function H(e){return k!==e}function w(e){return e.test(k)}function T(e){return e.exec(k)}function b(){return!!w(t.ws)}function E(){return n[k]}function _(e){var t=T(e);return t&&(t=t[0])?(z+=t.length,O+=t.length,k=k.substring(t.length),""===k&&x(),t):null}function L(){return{line:$,col:z,pos:O}}function D(){return{TOK:k,i:S,EOF:I,LINE:$,COL:z}}function A(e){k=e.TOK,S=e.i,I=e.EOF,$=e.LINE,z=e.COL}var S=0,I=0===r.length,k=!I&&r[S],$=0,z=0,O=0;return i()}}),e("genCode",["AST","sourcemap"],function(e,t){function n(e,t,n){var r,i,o=[],s=[],c=[],a=n+"    ",l=a+"     ",f="";for(i=0;i<t.length;i++)r=t[i].genDirectives(e,l),r&&(o.push(i),c.push(u(t[i])),s.push(r));if(o.length){for(f+=".child(["+o.join(", ")+"], function (__) {"+a,i=0;i<s.length;i++)i&&(f+=a),f+="// "+c[i]+a,f+="__["+i+"]"+s[i]+";";f+=n+"})"}return f}function r(e,t,n,r){var i,o="";for(i=0;i<t.length;i++)i&&r&&(o+=r),o+=t[i][n](e,o);return o}function i(e){return"'"+e.replace(a.backslashes,"\\\\").replace(a.singleQuotes,"\\'").replace(a.newlines,"\\\n")+"'"}function o(e,t){var n=a.eventProperty.test(e)?e.substring(2):"__";return"function ("+n+") { "+t+" }"}function s(e){var t=a.lastline.exec(e);return t=t?t[0]:"",t.replace(a.nonws," ")}function u(e){return c(e.beginTag||e.text||e.genHtml())}function c(e){var t=a.firstline.exec(e);return t?t[0]:""}var a={eventProperty:/^on/,backslashes:/\\/g,newlines:/\n/g,singleQuotes:/'/g,firstline:/^[^\n]*/,lastline:/[^\n]*$/,nonws:/\S/g};e.CodeTopLevel.prototype.genCode=e.EmbeddedCode.prototype.genCode=function(e){return r(e,this.segments,"genCode")},e.CodeText.prototype.genCode=function(e){return(e.sourcemap?t.segmentStart(this.loc):"")+this.text+(e.sourcemap?t.segmentEnd():"")};var l=0;e.HtmlLiteral.prototype.genCode=function(e,t){var o=r(e,this.nodes,"genHtml"),u="\n"+s(t),c=this.nodes.length>1?n(e,this.nodes,u):this.nodes[0].genDirectives(e,u),a="new "+e.symbol+"("+l++ +","+u+i(o)+")";return c&&(a+=u+c+u),a="("+a+".node)"},e.HtmlElement.prototype.genHtml=function(e){return this.beginTag+r(e,this.content,"genHtml")+(this.endTag||"")},e.HtmlComment.prototype.genHtml=e.HtmlText.prototype.genHtml=function(){return this.text},e.HtmlInsert.prototype.genHtml=function(){return"<!-- insert -->"},e.HtmlElement.prototype.genDirectives=function(e,t){var i=n(e,this.content,t),o=r(e,this.properties,"genDirective",t),s=r(e,this.directives,"genDirective",t);return o+(o&&(s||i)?t:"")+s+(s&&i?t:"")+i},e.HtmlComment.prototype.genDirectives=e.HtmlText.prototype.genDirectives=function(){return null},e.HtmlInsert.prototype.genDirectives=function(t){return new e.AttrStyleDirective("insert",[],this.code,!1).genDirective(t)},e.Property.prototype.genDirective=function(e){var t=this.code.genCode(e);return this.callback&&(t=o(this.name,t)),".property(function (__) { __."+this.name+" = "+t+"; })"},e.Directive.prototype.genDirective=function(e){return"."+this.name+"(function (__) { __"+this.code.genCode(e)+"; })"},e.AttrStyleDirective.prototype.genDirective=function(e){for(var t="."+this.name+"(function (__) { __(",n=0;n<this.params.length;n++)t+=i(this.params[n])+", ";return t+=this.callback?o(this.name,this.code.genCode(e)):this.code.genCode(e),t+="); })"}}),e("shims",["AST"],function(e){function t(){var e=document.createElement("ul");return e.innerHTML="    <li></li>",2===e.childNodes.length}function n(){s(e.HtmlText,function(t){!ws.test(this.text)||t.parent instanceof e.HtmlAttr||(this.text="&#xfeff;"+this.text)})}function r(){var e=document.createElement("ul");return e.innerHTML="<!-- --><li></li>",2===e.childNodes.length}function i(){s(e.HtmlComment,function(t){0===t.index&&u(new e.HtmlText("&#xfeff;"),t)})}function o(e,t){for(var n={index:0,parent:e,sibings:t};n.index<t.length;n.index++)t[n.index].shim(n)}function s(e,t){c=!0;var n=e.prototype.shim;e.prototype.shim=function(e){t.call(this,e),n.call(this,e)}}function u(e,t){t.siblings.splice(t.index,0,e),e.shim(t),t.index++}var c=!1;return e.CodeTopLevel.prototype.shim=function(e){o(this,this.segments,e)},e.HtmlLiteral.prototype.shim=function(e){o(this,this.nodes,e)},e.HtmlElement.prototype.shim=function(e){o(this,this.content,e)},e.HtmlInsert.prototype.shim=function(e){o(this,this.segments,e)},e.CodeText.prototype.shim=e.HtmlText.prototype.shim=e.HtmlComment.prototype.shim=function(){},t()||n(),r()||i(),c}),e("preprocess",["tokenize","parse","shims","sourcemap"],function(e,t,n,r){return function(i,o){o=o||{},o.symbol=o.symbol||"Html",o.sourcemap=o.sourcemap||null;var s=e(i,o),u=t(s,o);n&&u.shim();var c,a=u.genCode(o);return c="extract"===o.sourcemap?r.extractMap(a,i,o):"append"===o.sourcemap?r.appendMap(a,i,o):a}})});