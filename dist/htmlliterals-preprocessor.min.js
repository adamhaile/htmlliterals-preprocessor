!function(n){var t={},e={};n(function(n,e,o){if(t.hasOwnProperty(n))throw new Error("define: cannot redefine module "+n);t[n]=o.apply(null,e.map(function(e){if(!t.hasOwnProperty(e))throw new Error("define: module "+e+" required by "+n+" has not been defined.");return t[e]}))}),"object"==typeof exports?e=exports:"function"==typeof define?define([],function(){return e}):e=this.htmlliterals=this.htmlliterals||e,e.preprocess=t.preprocess}(function(n){"use strict";n("sourcemap",[],function(){function n(n){return"\x00"+n.line+","+n.col+"\x00"}function t(){return"\x00\x00"}function e(n){var t="",e=0,o=0,r=0,i=!1,c=0,l=!1,m=n.replace(u.locs,function(n,u,m,a,f,p,h){if(u)return t+=";",i?(t+="AA"+s(1)+s(0-r),o++,r=0,l=!0):l=!1,c=h+u.length,e=0,u;if(m){var d=h-c;return a=parseInt(a),f=parseInt(f),t+=(l?",":"")+s(d-e)+"A"+s(a-o)+s(f-r),i=!0,l=!0,e=d,o=a,r=f,""}return p?(i=!1,""):void 0});return{src:m,mappings:t}}function o(n,t){var o=e(n),i=r(o.mappings,t);return{src:o.src,map:i}}function r(n,t){return{version:3,file:"out.js",sources:["in.js"],sourcesContent:[t],names:[],mappings:n}}function i(n,t){var e=o(n,t),r=e.src+"\n//# sourceMappingURL=data:"+encodeURIComponent(JSON.stringify(e.map));return r}function s(n){var t,e="";for(n=0>n?(-n<<1)+1:n<<1,n=n.toString(32),t=n.length-1;t>0;t--)e+=l[parseInt(n[t],32)];return e+=c[parseInt(n[0],32)]}var u={locs:/(\n)|(\u0000(\d+),(\d+)\u0000)|(\u0000\u0000)/g},c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdef",l="ghijklmnopqrstuvwxyz0123456789+/";return{segmentStart:n,segmentEnd:t,extractMap:o,appendMap:i}}),n("tokenize",[],function(){var n={tokens:/<\/?(?=\w)|\/?>|<!--|-->|@|=|\)|\(|\[|\]|\{|\}|"|'|\/\/|\n|\/\*|\*\/|(?:[^<>@=\/@=()[\]{}"'\n*-]|(?!-->)-|\/(?![>\/*])|\*(?!\/)|(?!<\/?\w|<!--)<\/?)+/g};return function(t){var e=t.match(n.tokens);return e}}),n("AST",[],function(){return{CodeTopLevel:function(n){this.segments=n},CodeText:function(n,t){this.text=n,this.loc=t},EmbeddedCode:function(n){this.segments=n},HtmlLiteral:function(n){this.nodes=n},HtmlElement:function(n,t,e,o,r){this.beginTag=n,this.properties=t,this.mixins=e,this.content=o,this.endTag=r},HtmlText:function(n){this.text=n},HtmlComment:function(n){this.text=n},HtmlInsert:function(n){this.code=n},Property:function(n,t){this.name=n,this.code=t},Mixin:function(n){this.code=n}}}),n("parse",["AST"],function(n){var t={propertyLeftSide:/\s(\S+)\s*=\s*$/,stringEscapedEnd:/[^\\](\\\\)*\\$/,ws:/^\s*$/,leadingWs:/^\s+/,codeTerminator:/^[\s<>\/,;)\]}]/,codeContinuation:/^[^\s<>\/,;)\]}]+/,tagTrailingWs:/\s+(?=\/?>$)/,emptyLines:/\n\s+(?=\n)/g},e={"(":")","[":"]","{":"}"};return function(o){function r(){for(var t=[],e="",o=M();!O;)y("<")||y("<!--")||y("@")?(e&&t.push(new n.CodeText(e,o)),e="",t.push(i()),o=M()):y('"')||y("'")?e+=d():y("//")?e+=g():y("/*")?e+=x():(e+=k,C());return e&&t.push(new n.CodeText(e,o)),new n.CodeTopLevel(t)}function i(){H("<")&&H("<!--")&&H("@")&&v("not at start of html expression");for(var t,e,o=[];!O;)if(y("<"))o.push(s());else if(y("<!--"))o.push(l());else if(y("@"))o.push(m());else{if(t=I(),e=c(),O||!(y("<")||y("<!--")||y("@"))){S(t);break}o.push(e)}return new n.HtmlLiteral(o)}function s(){H("<")&&v("not at start of html element");var e=M(),o="",r=[],i=[],c=[],p="",h=!0;for(o+=k,C();!O&&H(">")&&H("/>");)y("@")?i.push(f()):y("=")?o=a(o,r):(o+=k,C());if(O&&v("unterminated start node",e),h=y(">"),o+=k,C(),o=o.replace(t.tagTrailingWs,"").replace(t.emptyLines,""),h){for(;!O&&H("</");)c.push(y("<")?s():y("@")?m():y("<!--")?l():u());for(O&&v("element missing close tag",e);!O&&H(">");)p+=k,C();O&&v("eof while looking for end of element close tag",e),p+=k,C()}return new n.HtmlElement(o,r,i,c,p)}function u(){for(var t="";!O&&H("<")&&H("<!--")&&H("@")&&H("</");)t+=k,C();return new n.HtmlText(t)}function c(){for(var t="";!O&&b();)t+=k,C();return new n.HtmlText(t)}function l(){H("<!--")&&v("not in HTML comment");for(var t=M(),e="";!O&&H("-->");)e+=k,C();return O&&v("unterminated html comment",t),e+=k,C(),new n.HtmlComment(e)}function m(){return H("@")&&v("not at start of code insert"),C(),new n.HtmlInsert(p())}function a(e,o){H("=")&&v("not at equals sign of a property assignment");var r,i;return e+=k,C(),b()&&(e+=k,C()),r=t.propertyLeftSide.exec(e),r&&(y('"')||y("'")?e+=d():(e=e.substring(0,e.length-r[0].length),i=r[1],L(t.leadingWs),o.push(new n.Property(i,p())))),e}function f(){return H("@")&&v("not at start of mixin"),C(),new n.Mixin(p())}function p(){for(var e=M(),o=[],r="",i=M();!O&&!T(t.codeTerminator);)E()?r=h(o,r,i):r+=y("'")||y('"')?d():L(t.codeContinuation);return r&&o.push(new n.CodeText(r,i)),0===o.length&&v("not in embedded code",e),new n.EmbeddedCode(o)}function h(t,e,o){var r=M(),s=E();for(void 0===s&&v("not in parentheses"),e+=k,C();!O&&H(s);)y("'")||y('"')?e+=d():y("//")?e+=g():y("/*")?e+=x():y("<")||y("<!--")||y("@")?(e&&t.push(new n.CodeText(e,{line:o.line,col:o.col})),e="",t.push(i()),o.line=j,o.col=N):E()?e=h(t,e,o):(e+=k,C());return O&&v("unterminated parentheses",r),e+=k,C(),e}function d(){H("'")&&H('"')&&v("not in quoted string");var n,e,o=M();for(n=e=k,C();!O&&(H(n)||t.stringEscapedEnd.test(e));)e+=k,C();return O&&v("unterminated string",o),e+=k,C(),e}function g(){H("//")&&v("not in code comment");for(var n="";!O&&H("\n");)n+=k,C();return O||(n+=k,C()),n}function x(){H("/*")&&v("not in code comment");for(var n=M(),t="";!O&&H("*/");)t+=k,C();return O&&v("unterminated multi-line comment",n),t+=k,C(),t}function C(){"\n"===k?(j++,N=0,P++):k&&(N+=k.length,P+=k.length),++A>=o.length?(O=!0,k=null):k=o[A]}function v(n,t){t=t||M();var e=" at line "+t.line+" col "+t.col+": ``"+o.join("").substr(t.pos,30).replace("\n","").replace("\r","")+"''";throw new Error(n+e)}function y(n){return k===n}function H(n){return k!==n}function T(n){return n.test(k)}function w(n){return n.exec(k)}function b(){return!!T(t.ws)}function E(){return e[k]}function L(n){var t=w(n);return t&&(t=t[0])?(N+=t.length,P+=t.length,k=k.substring(t.length),""===k&&C(),t):null}function M(){return{line:j,col:N,pos:P}}function I(){return{TOK:k,i:A,EOF:O,LINE:j,COL:N}}function S(n){k=n.TOK,A=n.i,O=n.EOF,j=n.LINE,N=n.COL}var A=0,O=0===o.length,k=!O&&o[A],j=0,N=0,P=0;return r()}}),n("genCode",["AST","sourcemap"],function(n,t){function e(n,t,e){return"var "+o(n)+" = "+o(t)+".childNodes["+e+"];"}function o(n){return"__"+(-1===n?"":n)}function r(n,t,e){var o,r=[],i=[],s=e+"    ";if(1===t.length)t[0].genCommands(n,r,i,-1,-1,0);else for(o=0;o<t.length;o++)t[o].genCommands(n,r,i,r.length,-1,o);return 0===i.length?null:"function (__) {"+s+r.join(s)+s+i.join(s)+s+"return __;"+e+"}"}function i(n,t,e,o){var r,i="";for(r=0;r<t.length;r++)r&&o&&(i+=o),i+=t[r][e](n,i);return i}function s(n){return"'"+n.replace(l.backslashes,"\\\\").replace(l.singleQuotes,"\\'").replace(l.newlines,"\\\n")+"'"}function u(n){var t=l.lastline.exec(n);return t=t?t[0]:"",t.replace(l.nonws," ")}function c(n){var t,e,o,r,i=0,s=0;for(t=0,e=n.length;e>t;t++)o=n.charCodeAt(t),r=31*i+o,i=0|r,o=(r-i)/m,s=31*s+o|0;return(1048575&s)*m+i}var l={backslashes:/\\/g,newlines:/\r?\n/g,singleQuotes:/'/g,firstline:/^[^\n]*/,lastline:/[^\n]*$/,nonws:/\S/g};n.CodeTopLevel.prototype.genCode=n.EmbeddedCode.prototype.genCode=function(n){return i(n,this.segments,"genCode")},n.CodeText.prototype.genCode=function(n){return(n.sourcemap?t.segmentStart(this.loc):"")+this.text+(n.sourcemap?t.segmentEnd():"")},n.HtmlLiteral.prototype.genCode=function(n,t){var e=i(n,this.nodes,"genHtml"),o=c(e),l="\r\n"+u(t),m=r(n,this.nodes,l),a=n.symbol+"("+o+","+l+s(e)+")";return m&&(a="("+m+")("+a+")"),a},n.HtmlElement.prototype.genHtml=function(n){return this.beginTag+i(n,this.content,"genHtml")+(this.endTag||"")},n.HtmlComment.prototype.genHtml=n.HtmlText.prototype.genHtml=function(){return this.text},n.HtmlInsert.prototype.genHtml=function(){return"<!-- insert -->"},n.HtmlElement.prototype.genCommands=function(n,t,o,r,i,s){for(var u=o.length,c=0;c<this.content.length;c++)this.content[c].genCommands(n,t,o,Math.max(r+1,t.length),r,c);for(c=0;c<this.properties.length;c++)this.properties[c].genCommand(n,o,r);for(c=0;c<this.mixins.length;c++)this.mixins[c].genCommand(n,o,r);o.length!==u&&-1!==r&&(t[r]=e(r,i,s))},n.HtmlComment.prototype.genCommands=n.HtmlText.prototype.genCommands=function(){},n.HtmlInsert.prototype.genCommands=function(n,t,r,i,s,u){t[i]=e(i,s,u),r.push(n.symbol+".exec(function (state) { return Html.insert("+o(i)+", "+this.code.genCode(n)+", state); });")},n.Property.prototype.genCommand=function(n,t,e){var r=this.code.genCode(n);t.push(n.symbol+".exec(function () { "+o(e)+"."+this.name+" = "+r+"; });")},n.Mixin.prototype.genCommand=function(n,t,e){this.code.genCode(n);t.push(n.symbol+".exec(function (state) { return "+this.code.genCode(n)+"("+o(e)+", state); });")};var m=Math.pow(2,32)}),n("shims",["AST"],function(n){function t(){u(n.HtmlText,function(t){m.ws.test(this.text)&&(0===t.index||t.sibings[t.index-1]instanceof n.HtmlElement)&&(t.index===t.sibings.length-1||t.sibings[t.index+1]instanceof n.HtmlElement)&&c(t)})}function e(){var n=document.createElement("ul");return n.innerHTML="    <li></li>",2===n.childNodes.length}function o(){u(n.HtmlText,function(t){!m.ws.test(this.text)||t.parent instanceof n.HtmlAttr||(this.text="&#xfeff;"+this.text)})}function r(){var n=document.createElement("ul");return n.innerHTML="<!-- --><li></li>",2===n.childNodes.length}function i(){u(n.HtmlComment,function(t){0===t.index&&l(new n.HtmlText("&#xfeff;"),t)})}function s(n,t){for(var e={index:0,parent:n,sibings:t,prune:!1};e.index<t.length;e.index++)t[e.index].shim(e),e.prune&&(t.splice(e.index,1),e.index--,e.prune=!1)}function u(n,t){a=!0;var e=n.prototype.shim;n.prototype.shim=function(n){t.call(this,n),n.prune||e.call(this,n)}}function c(n){n.prune=!0}function l(n,t){t.siblings.splice(t.index,0,n),n.shim(t),t.index++}var m={ws:/^\s*$/},a=!1;return n.CodeTopLevel.prototype.shim=function(n){s(this,this.segments,n)},n.HtmlLiteral.prototype.shim=function(n){s(this,this.nodes,n)},n.HtmlElement.prototype.shim=function(n){s(this,this.content,n)},n.HtmlInsert.prototype.shim=function(n){this.code.shim(n)},n.EmbeddedCode.prototype.shim=function(n){s(this,this.segments,n)},n.CodeText.prototype.shim=n.HtmlText.prototype.shim=n.HtmlComment.prototype.shim=function(){},t(),this&&this.document&&this.document.createElement&&(e()||o(),r()||i()),a}),n("preprocess",["tokenize","parse","shims","sourcemap"],function(n,t,e,o){return function(r,i){i=i||{},i.symbol=i.symbol||"Html",i.sourcemap=i.sourcemap||null;var s=n(r,i),u=t(s,i);e&&u.shim();var c,l=u.genCode(i);return c="extract"===i.sourcemap?o.extractMap(l,r,i):"append"===i.sourcemap?o.appendMap(l,r,i):l}})});