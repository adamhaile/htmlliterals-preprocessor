!function(n){var t={},e={};n(function(n,e,r){if(t.hasOwnProperty(n))throw new Error("define: cannot redefine module "+n);t[n]=r.apply(null,e.map(function(e){if(!t.hasOwnProperty(e))throw new Error("define: module "+e+" required by "+n+" has not been defined.");return t[e]}))}),"object"==typeof exports?e=exports:"function"==typeof define?define([],function(){return e}):e=this.htmlliterals=this.htmlliterals||e,e.preprocess=t.preprocess}(function(n){"use strict";n("sourcemap",[],function(){function n(n){return"\x00"+n.line+","+n.col+"\x00"}function t(){return"\x00\x00"}function e(n){var t="",e=0,r=0,o=0,i=!1,c=0,l=!1,a=n.replace(u.locs,function(n,u,a,f,p,m,h){if(u)return t+=";",i?(t+="AA"+s(1)+s(0-o),r++,o=0,l=!0):l=!1,c=h+u.length,e=0,u;if(a){var d=h-c;return f=parseInt(f),p=parseInt(p),t+=(l?",":"")+s(d-e)+"A"+s(f-r)+s(p-o),i=!0,l=!0,e=d,r=f,o=p,""}return m?(i=!1,""):void 0});return{src:a,mappings:t}}function r(n,t){var r=e(n),i=o(r.mappings,t);return{src:r.src,map:i}}function o(n,t){return{version:3,file:"out.js",sources:["in.js"],sourcesContent:[t],names:[],mappings:n}}function i(n,t){var e=r(n,t),o=e.src+"\n//# sourceMappingURL=data:"+encodeURIComponent(JSON.stringify(e.map));return o}function s(n){var t,e="";for(n=0>n?(-n<<1)+1:n<<1,n=n.toString(32),t=n.length-1;t>0;t--)e+=l[parseInt(n[t],32)];return e+=c[parseInt(n[0],32)]}var u={locs:/(\n)|(\u0000(\d+),(\d+)\u0000)|(\u0000\u0000)/g},c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdef",l="ghijklmnopqrstuvwxyz0123456789+/";return{segmentStart:n,segmentEnd:t,extractMap:r,appendMap:i}}),n("tokenize",[],function(){var n={tokens:/<\/?(?=\w)|\/?>|<!--|-->|@|=|\)|\(|\[|\]|\{|\}|"|'|\/\/|\n|\/\*|\*\/|(?:[^<>@=\/@=()[\]{}"'\n*-]|(?!-->)-|\/(?![>/*])|\*(?!\/)|(?!<\/?\w|<!--)<\/?)+/g};return function(t){var e=t.match(n.tokens);return e}}),n("AST",[],function(){return{CodeTopLevel:function(n){this.segments=n},CodeText:function(n,t){this.text=n,this.loc=t},EmbeddedCode:function(n){this.segments=n},HtmlLiteral:function(n){this.nodes=n},HtmlElement:function(n,t,e,r,o){this.beginTag=n,this.properties=t,this.mixins=e,this.content=r,this.endTag=o},HtmlText:function(n){this.text=n},HtmlComment:function(n){this.text=n},HtmlInsert:function(n){this.code=n},Property:function(n,t){this.name=n,this.code=t},Mixin:function(n){this.code=n}}}),n("parse",["AST"],function(n){var t={propertyLeftSide:/\s(\S+)\s*=\s*$/,stringEscapedEnd:/[^\\](\\\\)*\\$/,ws:/^\s*$/,leadingWs:/^\s+/,codeTerminator:/^[\s<>/,;)\]}]/,codeContinuation:/^[^\s<>/,;)\]}]+/,tagTrailingWs:/\s+(?=\/?>$)/,emptyLines:/\n\s+(?=\n)/g},e={"(":")","[":"]","{":"}"};return function(r){function o(){for(var t=[],e="",r=I();!O;)H("<")||H("<!--")||H("@")?(e&&t.push(new n.CodeText(e,r)),e="",t.push(i()),r=I()):H('"')||H("'")?e+=d():H("//")?e+=g():H("/*")?e+=v():(e+=k,x());return e&&t.push(new n.CodeText(e,r)),new n.CodeTopLevel(t)}function i(){T("<")&&T("<!--")&&T("@")&&y("not at start of html expression");for(var t,e,r=[];!O;)if(H("<"))r.push(s());else if(H("<!--"))r.push(l());else if(H("@"))r.push(a());else{if(t=S(),e=c(),O||!(H("<")||H("<!--")||H("@"))){M(t);break}r.push(e)}return new n.HtmlLiteral(r)}function s(){T("<")&&y("not at start of html element");var e=I(),r="",o=[],i=[],c=[],m="",h=!0;for(r+=k,x();!O&&T(">")&&T("/>");)H("@")?i.push(p()):H("=")?r=f(r,o):(r+=k,x());if(O&&y("unterminated start node",e),h=H(">"),r+=k,x(),r=r.replace(t.tagTrailingWs,"").replace(t.emptyLines,""),h){for(;!O&&T("</");)c.push(H("<")?s():H("@")?a():H("<!--")?l():u());for(O&&y("element missing close tag");!O&&T(">");)m+=k,x();O&&y("eof while looking for element close tag"),m+=k,x()}return new n.HtmlElement(r,o,i,c,m)}function u(){for(var t="";!O&&T("<")&&T("<!--")&&T("@")&&T("</");)t+=k,x();return new n.HtmlText(t)}function c(){for(var t="";!O&&E();)t+=k,x();return new n.HtmlText(t)}function l(){T("<!--")&&y("not in HTML comment");for(var t="";!O&&T("-->");)t+=k,x();return O&&y("unterminated html comment"),t+=k,x(),new n.HtmlComment(t)}function a(){return T("@")&&y("not at start of code insert"),x(),new n.HtmlInsert(m())}function f(e,r){T("=")&&y("not at equals sign of a property assignment");var o,i;return e+=k,x(),E()&&(e+=k,x()),o=t.propertyLeftSide.exec(e),o&&T('"')&&T("'")&&(e=e.substring(0,e.length-o[0].length),i=o[1],L(t.leadingWs),r.push(new n.Property(i,m()))),e}function p(){return T("@")&&y("not at start of mixin"),x(),new n.Mixin(m())}function m(){for(var e=I(),r=[],o="",i=I();!O&&!C(t.codeTerminator);)b()?o=h(r,o,i):o+=H("'")||H('"')?d():L(t.codeContinuation);return o&&r.push(new n.CodeText(o,i)),0===r.length&&y("not in embedded code",e),new n.EmbeddedCode(r)}function h(t,e,r){var o=I(),s=b();for(void 0===s&&y("not in parentheses"),e+=k,x();!O&&T(s);)H("'")||H('"')?e+=d():H("//")?e+=g():H("/*")?e+=v():H("<")||H("<!--")||H("@")?(e&&t.push(new n.CodeText(e,{line:r.line,col:r.col})),e="",t.push(i()),r.line=A,r.col=_):b()?e=h(t,e,r):(e+=k,x());return O&&y("unterminated parentheses",o),e+=k,x(),e}function d(){T("'")&&T('"')&&y("not in quoted string");var n,e;for(n=e=k,x();!O&&(T(n)||t.stringEscapedEnd.test(e));)e+=k,x();return O&&y("unterminated string"),e+=k,x(),e}function g(){T("//")&&y("not in code comment");for(var n="";!O&&T("\n");)n+=k,x();return O||(n+=k,x()),n}function v(){T("/*")&&y("not in code comment");for(var n="";!O&&T("*/");)n+=k,x();return O&&y("unterminated multi-line comment"),n+=k,x(),n}function x(){"\n"===k?(A++,_=0,j++):k&&(_+=k.length,j+=k.length),++D>=r.length?(O=!0,k=null):k=r[D]}function y(n,t){var e=t?" at line "+t.line+" col "+t.col+": ``"+r.join("").substr(t.pos,30).replace("\n","")+"''":"";throw new Error(n+e)}function H(n){return k===n}function T(n){return k!==n}function C(n){return n.test(k)}function w(n){return n.exec(k)}function E(){return!!C(t.ws)}function b(){return e[k]}function L(n){var t=w(n);return t&&(t=t[0])?(_+=t.length,j+=t.length,k=k.substring(t.length),""===k&&x(),t):null}function I(){return{line:A,col:_,pos:j}}function S(){return{TOK:k,i:D,EOF:O,LINE:A,COL:_}}function M(n){k=n.TOK,D=n.i,O=n.EOF,A=n.LINE,_=n.COL}var D=0,O=0===r.length,k=!O&&r[D],A=0,_=0,j=0;return o()}}),n("genCode",["AST","sourcemap"],function(n,t){function e(n,t,e){var r,o,i=[],u=[],c=[],l=e+"    ",a=l+"     ",f="";for(o=0;o<t.length;o++)r=t[o].genDirectives(n,a),r&&(i.push(o),c.push(s(t[o])),u.push(r));if(i.length){for(f+=".child(["+i.join(", ")+"], function (__) {"+l,o=0;o<u.length;o++)o&&(f+=l),f+="// "+c[o]+l,f+="__["+o+"]"+u[o]+";";f+=e+"})"}return f}function r(n,t,e,r){var o,i="";for(o=0;o<t.length;o++)o&&r&&(i+=r),i+=t[o][e](n,i);return i}function o(n){return"'"+n.replace(c.backslashes,"\\\\").replace(c.singleQuotes,"\\'").replace(c.newlines,"\\\n")+"'"}function i(n){var t=c.lastline.exec(n);return t=t?t[0]:"",t.replace(c.nonws," ")}function s(n){return u(n.beginTag||n.text||n.genHtml())}function u(n){var t=c.firstline.exec(n);return t?t[0]:""}var c={backslashes:/\\/g,newlines:/\n/g,singleQuotes:/'/g,firstline:/^[^\n]*/,lastline:/[^\n]*$/,nonws:/\S/g};n.CodeTopLevel.prototype.genCode=n.EmbeddedCode.prototype.genCode=function(n){return r(n,this.segments,"genCode")},n.CodeText.prototype.genCode=function(n){return(n.sourcemap?t.segmentStart(this.loc):"")+this.text+(n.sourcemap?t.segmentEnd():"")};var l=0;n.HtmlLiteral.prototype.genCode=function(n,t){var s=r(n,this.nodes,"genHtml"),u="\n"+i(t),c=this.nodes.length>1?e(n,this.nodes,u):this.nodes[0].genDirectives(n,u),a="new "+n.symbol+"("+l++ +","+u+o(s)+")";return c&&(a+=u+c+u),a="("+a+".node)"},n.HtmlElement.prototype.genHtml=function(n){return this.beginTag+r(n,this.content,"genHtml")+(this.endTag||"")},n.HtmlComment.prototype.genHtml=n.HtmlText.prototype.genHtml=function(){return this.text},n.HtmlInsert.prototype.genHtml=function(){return"<!-- insert -->"},n.HtmlElement.prototype.genDirectives=function(n,t){var o=e(n,this.content,t),i=r(n,this.properties,"genDirective",t),s=r(n,this.mixins,"genDirective",t);return o+(o&&(i||s)?t:"")+i+(i&&s?t:"")+s},n.HtmlComment.prototype.genDirectives=n.HtmlText.prototype.genDirectives=function(){return null},n.HtmlInsert.prototype.genDirectives=function(n){return".insert(function () { return "+this.code.genCode(n)+"; })"},n.Property.prototype.genDirective=function(n){var t=this.code.genCode(n);return".property(function (__) { __."+this.name+" = "+t+"; })"},n.Mixin.prototype.genDirective=function(n){return".mixin(function () { return "+this.code.genCode(n)+"; })"}}),n("shims",["AST"],function(n){function t(){var n=document.createElement("ul");return n.innerHTML="    <li></li>",2===n.childNodes.length}function e(){s(n.HtmlText,function(t){!c.ws.test(this.text)||t.parent instanceof n.HtmlAttr||(this.text="&#xfeff;"+this.text)})}function r(){var n=document.createElement("ul");return n.innerHTML="<!-- --><li></li>",2===n.childNodes.length}function o(){s(n.HtmlComment,function(t){0===t.index&&u(new n.HtmlText("&#xfeff;"),t)})}function i(n,t){for(var e={index:0,parent:n,sibings:t};e.index<t.length;e.index++)t[e.index].shim(e)}function s(n,t){l=!0;var e=n.prototype.shim;n.prototype.shim=function(n){t.call(this,n),e.call(this,n)}}function u(n,t){t.siblings.splice(t.index,0,n),n.shim(t),t.index++}if(!this||!this.document)return!1;var c={ws:/^\s*$/},l=!1;return n.CodeTopLevel.prototype.shim=function(n){i(this,this.segments,n)},n.HtmlLiteral.prototype.shim=function(n){i(this,this.nodes,n)},n.HtmlElement.prototype.shim=function(n){i(this,this.content,n)},n.HtmlInsert.prototype.shim=function(n){i(this,this.segments,n)},n.CodeText.prototype.shim=n.HtmlText.prototype.shim=n.HtmlComment.prototype.shim=function(){},t()||e(),r()||o(),l}),n("preprocess",["tokenize","parse","shims","sourcemap"],function(n,t,e,r){return function(o,i){i=i||{},i.symbol=i.symbol||"Html",i.sourcemap=i.sourcemap||null;var s=n(o,i),u=t(s,i);e&&u.shim();var c,l=u.genCode(i);return c="extract"===i.sourcemap?r.extractMap(l,o,i):"append"===i.sourcemap?r.appendMap(l,o,i):l}})});