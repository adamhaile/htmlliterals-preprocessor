!function(t){var e={},n={};t(function(t,n,o){if(e.hasOwnProperty(t))throw new Error("define: cannot redefine module "+t);e[t]=o.apply(null,n.map(function(n){if(!e.hasOwnProperty(n))throw new Error("define: module "+n+" required by "+t+" has not been defined.");return e[n]}))}),"object"==typeof exports?n=exports:"function"==typeof define?define([],function(){return n}):n=this.htmlliterals=this.htmlliterals||n,n.preprocess=e.preprocess}(function(t){"use strict";t("sourcemap",[],function(){function t(t){return"\x00"+t.line+","+t.col+"\x00"}function e(){return"\x00\x00"}function n(t){var e="",n=0,o=0,r=0,i=!1,c=0,a=!1,m=t.replace(u.locs,function(t,u,m,p,l,f,d){if(u)return e+=";",i?(e+="AA"+s(1)+s(0-r),o++,r=0,a=!0):a=!1,c=d+u.length,n=0,u;if(m){var h=d-c;return p=parseInt(p),l=parseInt(l),e+=(a?",":"")+s(h-n)+"A"+s(p-o)+s(l-r),i=!0,a=!0,n=h,o=p,r=l,""}return f?(i=!1,""):void 0});return{src:m,mappings:e}}function o(t,e){var o=n(t),i=r(o.mappings,e);return{src:o.src,map:i}}function r(t,e){return{version:3,file:"out.js",sources:["in.js"],sourcesContent:[e],names:[],mappings:t}}function i(t,e){var n=o(t,e),r=n.src+"\n//# sourceMappingURL=data:"+encodeURIComponent(JSON.stringify(n.map));return r}function s(t){var e,n="";for(t=0>t?(-t<<1)+1:t<<1,t=t.toString(32),e=t.length-1;e>0;e--)n+=a[parseInt(t[e],32)];return n+=c[parseInt(t[0],32)]}var u={locs:/(\n)|(\u0000(\d+),(\d+)\u0000)|(\u0000\u0000)/g},c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdef",a="ghijklmnopqrstuvwxyz0123456789+/";return{segmentStart:t,segmentEnd:e,extractMap:o,appendMap:i}}),t("tokenize",[],function(){var t={tokens:/<\/?(?=\w)|\/?>|<!--|-->|@|=|\)|\(|\[|\]|\{|\}|"|'|\/\/|\n|\/\*|\*\/|(?:[^<>@=\/@=()[\]{}"'\n*-]|(?!-->)-|\/(?![>\/*])|\*(?!\/)|(?!<\/?\w|<!--)<\/?)+/g};return function(e){var n=e.match(t.tokens);return n}}),t("AST",[],function(){return{CodeTopLevel:function(t){this.segments=t},CodeText:function(t,e){this.text=t,this.loc=e},EmbeddedCode:function(t){this.segments=t},HtmlElement:function(t,e,n){this.tag=t,this.properties=e,this.content=n},HtmlText:function(t){this.text=t},HtmlComment:function(t){this.text=t},HtmlInsert:function(t){this.code=t},StaticProperty:function(t,e){this.name=t,this.value=e},DynamicProperty:function(t,e){this.name=t,this.code=e},Mixin:function(t){this.code=t}}}),t("parse",["AST"],function(t){var e={identifier:/^[a-z]\w*/,stringEscapedEnd:/[^\\](\\\\)*\\$/,leadingWs:/^\s+/,codeTerminator:/^[\s<>\/,;)\]}]/,codeContinuation:/^[^\s<>\/,;)\]}]+/},n={"(":")","[":"]","{":"}"};return function(o){function r(){for(var e=[],n="",o=E();!b;)v("<")?(n&&e.push(new t.CodeText(n,o)),n="",e.push(i()),o=E()):v('"')||v("'")?n+=f():v("//")?n+=d():v("/*")?n+=h():(n+=M,g());return n&&e.push(new t.CodeText(n,o)),new t.CodeTopLevel(e)}function i(){y("<")&&x("not at start of html element");var n=E(),o="",r=[],p=[],l=!0;for(g(),o=H(e.identifier),o||x("bad element name",n),H(e.leadingWs);!b&&y(">")&&y("/>");)C(e.identifier)?r.push(a()):v("@")?r.push(m()):x("unrecognized content in begin tag"),H(e.leadingWs);if(b&&x("unterminated start node",n),l=v(">"),g(),l){for(;!b&&y("</");)p.push(v("<")?i():v("@")?c():v("<!--")?u():s());b&&x("element missing close tag",n),g(),o!==H(e.identifier)&&x("mismatched open and close tags",n),y(">")&&x("malformed close tag"),g()}return new t.HtmlElement(o,r,p)}function s(){for(var e="";!b&&y("<")&&y("<!--")&&y("@")&&y("</");)e+=M,g();return new t.HtmlText(e)}function u(){y("<!--")&&x("not in HTML comment");for(var e=E(),n="";!b&&y("-->");)n+=M,g();return b&&x("unterminated html comment",e),n+=M,g(),new t.HtmlComment(n)}function c(){return y("@")&&x("not at start of code insert"),g(),new t.HtmlInsert(p())}function a(){C(e.identifier)||x("not at start of property declaration");var n=H(e.identifier);return H(e.leadingWs),y("=")&&x("expected equals sign after property name"),g(),H(e.leadingWs),v('"')||v("'")?new t.StaticProperty(n,f()):new t.DynamicProperty(n,p())}function m(){return y("@")&&x("not at start of mixin"),g(),new t.Mixin(p())}function p(){for(var n=E(),o=[],r="",i=E();!b&&!C(e.codeTerminator);)T()?r=l(o,r,i):r+=v("'")||v('"')?f():H(e.codeContinuation);return r&&o.push(new t.CodeText(r,i)),0===o.length&&x("not in embedded code",n),new t.EmbeddedCode(o)}function l(e,n,o){var r=E(),s=T();for(void 0===s&&x("not in parentheses"),n+=M,g();!b&&y(s);)v("'")||v('"')?n+=f():v("//")?n+=d():v("/*")?n+=h():v("<")?(n&&e.push(new t.CodeText(n,{line:o.line,col:o.col})),n="",e.push(i()),o.line=O,o.col=D,o.POS=_):T()?n=l(e,n,o):(n+=M,g());return b&&x("unterminated parentheses",r),n+=M,g(),n}function f(){y("'")&&y('"')&&x("not in quoted string");var t,n,o=E();for(t=n=M,g();!b&&(y(t)||e.stringEscapedEnd.test(n));)n+=M,g();return b&&x("unterminated string",o),n+=M,g(),n}function d(){y("//")&&x("not in code comment");for(var t="";!b&&y("\n");)t+=M,g();return b||(t+=M,g()),t}function h(){y("/*")&&x("not in code comment");for(var t=E(),e="";!b&&y("*/");)e+=M,g();return b&&x("unterminated multi-line comment",t),e+=M,g(),e}function g(){"\n"===M?(O++,D=0,_++):M&&(D+=M.length,_+=M.length),++S>=o.length?(b=!0,M=null):M=o[S]}function x(t,e){e=e||E();var n=" at line "+e.line+" col "+e.col+": ``"+o.join("").substr(e.pos,30).replace("\n","").replace("\r","")+"''";throw new Error(t+n)}function v(t){return M===t}function y(t){return M!==t}function C(t){return t.test(M)}function w(t){return t.exec(M)}function T(){return n[M]}function H(t){var e=w(t);return e&&(e=e[0])?(D+=e.length,_+=e.length,M=M.substring(e.length),""===M&&g(),e):null}function E(){return{line:O,col:D,pos:_}}var S=0,b=0===o.length,M=!b&&o[S],O=0,D=0,_=0;return r()}}),t("genCode",["AST","sourcemap"],function(t,e){function n(t,e,n,o){var r=null===e?"__":e+("_"===e[e.length-1]?"":"_")+n+(o+1);return t.push(r),r}function o(t,e,n){t.push(e+" = document.createElement('"+n+"');")}function r(t,e,n){t.push(e+" = document.createComment("+a(n)+");")}function i(t,e,n){t.push(e+" = document.createTextNode("+a(n)+");")}function s(t,e,n){t.push(e+".appendChild("+n+");")}function u(t,e,n,o){var r,i="";for(r=0;r<e.length;r++)r&&o&&(i+=o),i+=e[r][n](t,i);return i}function c(t){var e=m.indent.exec(t);return e?e[1]:""}function a(t){return"'"+t.replace(m.backslashes,"\\\\").replace(m.singleQuotes,"\\'").replace(m.newlines,"\\\n")+"'"}var m={backslashes:/\\/g,newlines:/\r?\n/g,singleQuotes:/'/g,indent:/\n(?=[^\n]+$)([ \t]*)/};t.CodeTopLevel.prototype.genCode=t.EmbeddedCode.prototype.genCode=function(t){return u(t,this.segments,"genCode")},t.CodeText.prototype.genCode=function(t){return(t.sourcemap?e.segmentStart(this.loc):"")+this.text+(t.sourcemap?e.segmentEnd():"")},t.HtmlElement.prototype.genCode=function(t,e){var n="\r\n"+c(e),o=n+"    ",r=o+"    ",i=[],s=[],u=[];return this.genDOMStatements(t,i,s,u,null,0),"(function () {"+r+"var "+i.join(", ")+";"+r+s.join(r)+r+u.join(r)+r+"return __;"+o+"})()"},t.HtmlElement.prototype.genDOMStatements=function(t,e,r,i,u,c){var a=n(e,u,this.tag,c),m=[];o(r,a,this.tag);for(var p=0;p<this.properties.length;p++)this.properties[p].genDOMStatements(t,e,r,m,a,p);for(p=0;p<this.content.length;p++)this.content[p].genDOMStatements(t,e,r,i,a,p);i.push.apply(i,m),u&&s(r,u,a)},t.HtmlComment.prototype.genDOMStatements=function(t,e,o,i,u,c){var a=n(e,u,"comment",c);r(o,a,this.text),s(o,u,a)},t.HtmlText.prototype.genDOMStatements=function(t,e,o,r,u,c){var a=n(e,u,"text",c);i(o,a,this.text),s(o,u,a)},t.HtmlInsert.prototype.genDOMStatements=function(t,e,o,i,u,c){var a=n(e,u,"insert",c);r(o,a,"insert"),s(o,u,a),i.push(t.symbol+".exec(function (__state) { return Html.insert("+a+", "+this.code.genCode(t)+", __state); });")},t.StaticProperty.prototype.genDOMStatements=function(t,e,n,o,r){n.push(r+"."+this.name+" = "+this.value+";")},t.DynamicProperty.prototype.genDOMStatements=function(t,e,n,o,r){var i=this.code.genCode(t);o.push(t.symbol+".exec(function () { "+r+"."+this.name+" = "+i+"; });")},t.Mixin.prototype.genDOMStatements=function(t,e,n,o,r){var i=this.code.genCode(t);o.push(t.symbol+".exec(function (__state) { return "+i+"("+r+", __state); });")}}),t("shims",["AST"],function(t){function e(){u(t.HtmlText,function(t){m.ws.test(this.text)&&c(t)})}function n(){var t=document.createElement("ul");return t.innerHTML="    <li></li>",2===t.childNodes.length}function o(){u(t.HtmlText,function(e){!m.ws.test(this.text)||e.parent instanceof t.HtmlAttr||(this.text="&#xfeff;"+this.text)})}function r(){var t=document.createElement("ul");return t.innerHTML="<!-- --><li></li>",2===t.childNodes.length}function i(){u(t.HtmlComment,function(e){0===e.index&&a(new t.HtmlText("&#xfeff;"),e)})}function s(t,e){for(var n={index:0,parent:t,sibings:e,prune:!1};n.index<e.length;n.index++)e[n.index].shim(n),n.prune&&(e.splice(n.index,1),n.index--,n.prune=!1)}function u(t,e){p=!0;var n=t.prototype.shim;t.prototype.shim=function(t){e.call(this,t),t.prune||n.call(this,t)}}function c(t){t.prune=!0}function a(t,e){e.siblings.splice(e.index,0,t),t.shim(e),e.index++}var m={ws:/^\s*$/},p=!1;return t.CodeTopLevel.prototype.shim=function(t){s(this,this.segments,t)},t.HtmlElement.prototype.shim=function(t){s(this,this.content,t)},t.HtmlInsert.prototype.shim=function(t){this.code.shim(t)},t.EmbeddedCode.prototype.shim=function(t){s(this,this.segments,t)},t.CodeText.prototype.shim=t.HtmlText.prototype.shim=t.HtmlComment.prototype.shim=function(){},e(),this&&this.document&&this.document.createElement&&(n()||o(),r()||i()),p}),t("preprocess",["tokenize","parse","shims","sourcemap"],function(t,e,n,o){return function(r,i){i=i||{},i.symbol=i.symbol||"Html",i.sourcemap=i.sourcemap||null;var s=t(r,i),u=e(s,i);n&&u.shim();var c,a=u.genCode(i);return c="extract"===i.sourcemap?o.extractMap(a,r,i):"append"===i.sourcemap?o.appendMap(a,r,i):a}})});